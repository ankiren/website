---
title: "US-6.4: View Score History"
epic: Skill Management
status: Planned
priority: High
github_issue: ""
---

# US-6.4: View Score History

## Description

As a **user**,
I want to **view my score history for each skill**,
So that **I can see my progress and understand my learning journey**.

---

## Acceptance Criteria

| AC | Title | Description |
|----|-------|-------------|
| AC-6.4.1 | View History List | User can see all recorded scores |
| AC-6.4.2 | History Details | Each entry shows score, source, date, note |
| AC-6.4.3 | Filter History | User can filter by source or date range |
| AC-6.4.4 | Delete History Entry | User can delete individual entries |

---

### AC-6.4.1: View History List

```gherkin
Scenario: View score history
  Given I am logged in as a user
  And I have recorded multiple scores for "Reading"
  When I navigate to the "Reading" skill detail page
  Then I should see "Score History" section
  And I should see all recorded scores in chronological order
  And most recent scores should appear first

Scenario: Empty history
  Given I am logged in as a user
  And I just added "Writing" to my tracked skills
  And I have not recorded any scores
  When I view the "Writing" skill detail page
  Then I should see "No scores recorded yet" message
  And I should see "Record your first score" prompt
```

### AC-6.4.2: History Details

```gherkin
Scenario: View history entry details
  Given I am logged in as a user
  And I have recorded a score with:
    | Score  | 75                          |
    | Source | test                        |
    | Note   | IELTS practice test         |
    | Date   | 2025-12-13 10:00            |
  When I view my score history
  Then I should see the score "75"
  And I should see source badge "Test"
  And I should see the note "IELTS practice test"
  And I should see the date "Dec 13, 2025"

Scenario: Source badges
  Given I have history entries with different sources
  When I view the history
  Then "test" entries should have a blue badge
  And "practice" entries should have a green badge
  And "assessment" entries should have an orange badge
```

### AC-6.4.3: Filter History

```gherkin
Scenario: Filter by source
  Given I have 10 history entries with mixed sources
  When I select "test" in the source filter
  Then I should only see entries with source "test"
  When I select "All Sources"
  Then I should see all entries

Scenario: Filter by date range
  Given I have entries from the past 3 months
  When I select "Last 30 days" filter
  Then I should only see entries from the last 30 days
  When I select "Last 7 days"
  Then I should only see entries from the last 7 days

Scenario: Combined filters
  Given I have entries with various sources and dates
  When I filter by source "test" and "Last 30 days"
  Then I should only see test entries from the last 30 days
```

### AC-6.4.4: Delete History Entry

```gherkin
Scenario: Delete a history entry
  Given I am logged in as a user
  And I have a score entry I want to delete
  When I click the delete button on the entry
  And I confirm the deletion
  Then the entry should be removed from history
  And I should see a success message

Scenario: Current score updates after deletion
  Given I have scores: 50, 60, 75 (current is 75)
  When I delete the entry with score 75
  Then the entry should be removed
  And my current score should update to 60 (most recent remaining)

Scenario: Deleting last entry
  Given I have only one score entry (75)
  When I delete this entry
  Then my score history should be empty
  And my current score should become empty
```

---

## Technical Notes

### Implementation
- **Page**: `src/app/dashboard/skills/[id]/page.tsx` - Skill detail with history
- **API**: `src/app/api/me/skills/[skillId]/history/route.ts` - History endpoints
- **Component**: `src/components/ScoreHistory.tsx` - History list component

### Database
```sql
-- Get score history
SELECT h.*, us.skill_id
FROM Users_Skills_History h
JOIN Users_Skills us ON h.user_skill_id = us.id
WHERE us.user_id = :userId AND us.skill_id = :skillId
ORDER BY h.created_at DESC;

-- Filter by source
SELECT * FROM Users_Skills_History
WHERE user_skill_id = :userSkillId
  AND source = :source
ORDER BY created_at DESC;

-- Filter by date range
SELECT * FROM Users_Skills_History
WHERE user_skill_id = :userSkillId
  AND created_at >= :startDate
ORDER BY created_at DESC;

-- Delete entry
DELETE FROM Users_Skills_History WHERE id = :id;

-- Update current score after deletion
UPDATE Users_Skills
SET current_score = (
  SELECT score FROM Users_Skills_History
  WHERE user_skill_id = :userSkillId
  ORDER BY created_at DESC LIMIT 1
)
WHERE id = :userSkillId;
```

### API Endpoints
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/me/skills/:skillId/history` | Get score history |
| GET | `/api/me/skills/:skillId/history?source=test` | Filter by source |
| GET | `/api/me/skills/:skillId/history?days=30` | Filter by date |
| DELETE | `/api/me/skills/:skillId/history/:id` | Delete entry |

### Response Format
```json
{
  "history": [
    {
      "id": "h1",
      "score": 75,
      "source": "test",
      "note": "IELTS practice test",
      "createdAt": "2025-12-13T10:00:00Z"
    },
    {
      "id": "h2",
      "score": 60,
      "source": "practice",
      "note": null,
      "createdAt": "2025-12-10T15:30:00Z"
    }
  ],
  "total": 2
}
```

---

## RICE Score

| Factor | Value | Rationale |
|--------|-------|-----------|
| Reach | 50% | All users tracking skills |
| Impact | 2 (High) | Essential for progress tracking |
| Confidence | 80% | Standard list/filter UI |
| Effort | 1 week | API + UI + filters |

**Score:** (50 × 2 × 0.8) / 1 = **80**
