---
title: "US-5.1: Role Management"
epic: Authorization
status: Planned
priority: Critical
github_issue: ""
---

# US-5.1: Role Management

## Description

As an **administrator**,
I want to **create, edit, and delete roles**,
So that **I can define different access levels for users in the system**.

---

## Acceptance Criteria

### AC-5.1.1: View Roles List

```gherkin
Scenario: View all roles
  Given I am logged in as an Admin
  When I navigate to "/dashboard/admin/roles"
  Then I should see a list of all roles
  And I should see role name, description, and user count for each role
  And I should see system roles marked as "System"
```

### AC-5.1.2: Create New Role

```gherkin
Scenario: Create a new role
  Given I am logged in as an Admin
  And I am on the roles management page
  When I click "Create Role" button
  And I enter role name "Team Lead"
  And I enter description "Leads a team of developers"
  And I click "Save" button
  Then the role "Team Lead" should be created
  And I should see a success message
  And the new role should appear in the roles list

Scenario: Create role with duplicate name
  Given I am logged in as an Admin
  And a role named "Manager" already exists
  When I try to create a role with name "Manager"
  Then I should see an error message "Role name already exists"
  And the role should not be created
```

### AC-5.1.3: Edit Role

```gherkin
Scenario: Edit an existing role
  Given I am logged in as an Admin
  And a role "Team Lead" exists
  When I click the edit button for "Team Lead"
  And I change the description to "Leads a development team"
  And I click "Save" button
  Then the role should be updated
  And I should see a success message

Scenario: Cannot edit system role name
  Given I am logged in as an Admin
  And "Admin" is a system role
  When I try to edit the "Admin" role
  Then the role name field should be disabled
  And I should see a message "System role name cannot be changed"
```

### AC-5.1.4: Delete Role

```gherkin
Scenario: Delete a custom role
  Given I am logged in as an Admin
  And a custom role "Team Lead" exists with no users assigned
  When I click the delete button for "Team Lead"
  And I confirm the deletion
  Then the role should be deleted
  And I should see a success message

Scenario: Cannot delete role with assigned users
  Given I am logged in as an Admin
  And a role "Manager" has users assigned
  When I try to delete the "Manager" role
  Then I should see an error message "Cannot delete role with assigned users"
  And the role should not be deleted

Scenario: Cannot delete system role
  Given I am logged in as an Admin
  And "Admin" is a system role
  When I try to delete the "Admin" role
  Then I should see an error message "System roles cannot be deleted"
  And the role should not be deleted
```

### AC-5.1.5: Default System Roles

```gherkin
Scenario: System roles exist by default
  Given the system is initialized
  Then the following system roles should exist:
    | Role    | Description                |
    | Admin   | System administrator       |
    | User    | Regular user               |
  And these roles should be marked as system roles
  And these roles cannot be deleted
```

---

## Technical Notes

### Implementation
- **Page**: `src/app/dashboard/admin/roles/page.tsx` - Roles management page
- **API**: `src/app/api/roles/route.ts` - CRUD endpoints
- **Component**: `src/components/RoleManager.tsx` - Role management UI

### Database
```sql
-- Create role
INSERT INTO Role (id, name, description, isSystem, createdAt, updatedAt)
VALUES (cuid(), 'Team Lead', 'Leads a team', false, now, now);

-- Update role
UPDATE Role SET description = 'New description', updatedAt = now WHERE id = ?;

-- Delete role (only if no users assigned)
DELETE FROM Role WHERE id = ? AND isSystem = false;
```

### API Endpoints
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/roles` | List all roles |
| POST | `/api/roles` | Create new role |
| PUT | `/api/roles/:id` | Update role |
| DELETE | `/api/roles/:id` | Delete role |

### Error Handling
| Error | HTTP Status | Message |
|-------|-------------|---------|
| Role not found | 404 | "Role not found" |
| Duplicate name | 409 | "Role name already exists" |
| System role | 403 | "System roles cannot be deleted" |
| Has users | 400 | "Cannot delete role with assigned users" |

---

## RICE Score

| Factor | Value | Rationale |
|--------|-------|-----------|
| Reach | 30% | Only admins use this feature |
| Impact | 3 (Massive) | Foundation for RBAC system |
| Confidence | 80% | Standard CRUD operations |
| Effort | 1 week | API + UI + validation |

**Score:** (30 × 3 × 0.8) / 1 = **72**
