---
title: "US-5.3: Permission Management"
epic: Authorization
status: Planned
priority: Critical
github_issue: ""
---

# US-5.3: Permission Management

## Description

As an **administrator**,
I want to **manage permissions and assign them to roles**,
So that **I can define granular access control for each role**.

---

## Acceptance Criteria

| AC | Title | Description |
|----|-------|-------------|
| AC-5.3.1 | View All Permissions | Admin can view all permissions |
| AC-5.3.2 | Create New Permission | Admin can create permissions |
| AC-5.3.3 | Edit Permission | Admin can edit permission details |
| AC-5.3.4 | Delete Permission | Admin can delete unused permissions |
| AC-5.3.5 | View Role Permissions | View permissions assigned to a role |
| AC-5.3.6 | Assign Permissions to Role | Assign permissions to roles |
| AC-5.3.7 | Remove Permissions from Role | Remove permissions from roles |
| AC-5.3.8 | Admin Role Permissions | Admin role has all permissions |

---

### AC-5.3.1: View All Permissions

```gherkin
Scenario: View all permissions
  Given I am logged in as an Admin
  When I navigate to "/dashboard/admin/permissions"
  Then I should see a list of all permissions
  And I should see permission code, name, description, and module
  And permissions should be grouped by module
```

### AC-5.3.2: Create New Permission

```gherkin
Scenario: Create a new permission
  Given I am logged in as an Admin
  And I am on the permissions management page
  When I click "Create Permission" button
  And I enter code "view_dashboard"
  And I enter name "View Dashboard"
  And I enter description "Access to view dashboard"
  And I select module "system"
  And I click "Save"
  Then the permission should be created
  And I should see a success message

Scenario: Create permission with duplicate code
  Given I am logged in as an Admin
  And a permission with code "manage_users" already exists
  When I try to create a permission with code "manage_users"
  Then I should see an error message "Permission code already exists"
  And the permission should not be created
```

### AC-5.3.3: Edit Permission

```gherkin
Scenario: Edit an existing permission
  Given I am logged in as an Admin
  And a permission "view_dashboard" exists
  When I click the edit button for "view_dashboard"
  And I change the description to "Access to view main dashboard"
  And I click "Save"
  Then the permission should be updated
  And I should see a success message

Scenario: Cannot edit permission code
  Given I am logged in as an Admin
  When I edit an existing permission
  Then the code field should be disabled
  And I should see a message "Permission code cannot be changed"
```

### AC-5.3.4: Delete Permission

```gherkin
Scenario: Delete a permission
  Given I am logged in as an Admin
  And a permission "view_dashboard" exists
  And no roles have this permission assigned
  When I click the delete button for "view_dashboard"
  And I confirm the deletion
  Then the permission should be deleted
  And I should see a success message

Scenario: Cannot delete permission assigned to roles
  Given I am logged in as an Admin
  And permission "manage_users" is assigned to role "Admin"
  When I try to delete "manage_users"
  Then I should see an error message "Cannot delete permission assigned to roles"
  And the permission should not be deleted
```

### AC-5.3.5: View Role Permissions

```gherkin
Scenario: View permissions assigned to a role
  Given I am logged in as an Admin
  When I navigate to role details page
  Then I should see all permissions assigned to that role
  And permissions should be grouped by module
  And I should see permission name and description
```

### AC-5.3.6: Assign Permissions to Role

```gherkin
Scenario: Assign permissions to a role
  Given I am logged in as an Admin
  And I am editing a custom role
  When I check a permission
  And I click "Save Permissions"
  Then the permission should be assigned to the role
  And I should see a success message

Scenario: Assign all permissions in a module
  Given I am logged in as an Admin
  And I am editing a role
  When I click "Select All" for a module
  Then all permissions in that module should be selected
```

### AC-5.3.7: Remove Permissions from Role

```gherkin
Scenario: Remove a permission from a role
  Given I am logged in as an Admin
  And a role has a permission assigned
  When I uncheck the permission
  And I click "Save Permissions"
  Then the permission should be removed from the role
  And I should see a success message
```

### AC-5.3.8: Admin Role Permissions

```gherkin
Scenario: Admin role has all permissions
  Given I am logged in as an Admin
  When I view the "Admin" role permissions
  Then all permissions should be assigned
  And I should not be able to remove permissions from Admin role
```

---

## Technical Notes

### Implementation
- **Page**: `src/app/dashboard/admin/permissions/page.tsx` - Permissions list
- **Page**: `src/app/dashboard/admin/roles/[id]/permissions/page.tsx` - Role permission assignment
- **API**: `src/app/api/permissions/route.ts` - Permission CRUD endpoints
- **API**: `src/app/api/roles/[id]/permissions/route.ts` - Role permission endpoints
- **Component**: `src/components/PermissionEditor.tsx` - Permission checkbox UI

### Database
```sql
-- List all permissions
SELECT * FROM Permission ORDER BY module, name;

-- Create permission
INSERT INTO Permission (id, code, name, description, module, createdAt)
VALUES (cuid(), ?, ?, ?, ?, now);

-- Update permission
UPDATE Permission SET name = ?, description = ?, module = ? WHERE id = ?;

-- Delete permission (only if not assigned to any role)
DELETE FROM Permission WHERE id = ?
AND NOT EXISTS (SELECT 1 FROM RolePermission WHERE permissionId = ?);

-- Get role permissions
SELECT p.* FROM Permission p
JOIN RolePermission rp ON p.id = rp.permissionId
WHERE rp.roleId = ?;

-- Assign permission to role
INSERT INTO RolePermission (id, roleId, permissionId, createdAt)
VALUES (cuid(), ?, ?, now);

-- Remove permission from role
DELETE FROM RolePermission WHERE roleId = ? AND permissionId = ?;
```

### API Endpoints
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/permissions` | List all permissions |
| POST | `/api/permissions` | Create new permission |
| PUT | `/api/permissions/:id` | Update permission |
| DELETE | `/api/permissions/:id` | Delete permission |
| GET | `/api/roles/:id/permissions` | Get role permissions |
| PUT | `/api/roles/:id/permissions` | Update role permissions |

### Default Permission Modules
| Module | Description |
|--------|-------------|
| user | User and role management |
| system | System settings and configuration |

### Error Handling
| Error | HTTP Status | Message |
|-------|-------------|---------|
| Permission not found | 404 | "Permission not found" |
| Duplicate code | 409 | "Permission code already exists" |
| Has roles | 400 | "Cannot delete permission assigned to roles" |
| Admin role | 403 | "Cannot modify Admin role permissions" |

---

## RICE Score

| Factor | Value | Rationale |
|--------|-------|-----------|
| Reach | 30% | Only admins use this feature |
| Impact | 3 (Massive) | Enables granular access control |
| Confidence | 80% | Standard permission patterns |
| Effort | 1 week | UI for permission CRUD + assignment |

**Score:** (30 × 3 × 0.8) / 1 = **72**
