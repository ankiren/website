---
title: "US-5.5: User Management"
epic: Authorization
status: Planned
priority: High
github_issue: ""
---

# US-5.5: User Management

## Description

As an **administrator**,
I want to **view and manage all users in the system**,
So that **I can oversee user accounts and maintain system integrity**.

---

## Acceptance Criteria

| AC | Title | Description |
|----|-------|-------------|
| AC-5.5.1 | View Users List | Admin can view all users |
| AC-5.5.2 | View User Details | Admin can view user details |
| AC-5.5.3 | Edit User | Admin can edit user information |
| AC-5.5.4 | Deactivate User | Admin can deactivate users |
| AC-5.5.5 | Reactivate User | Admin can reactivate users |
| AC-5.5.6 | Delete User | Admin can delete users |

---

### AC-5.5.1: View Users List

```gherkin
Scenario: View all users
  Given I am logged in as an Admin
  When I navigate to "/dashboard/admin/users"
  Then I should see a list of all users
  And I should see name, email, roles, and status for each user
  And users should be paginated (20 per page)

Scenario: Search users
  Given I am logged in as an Admin
  And I am on the users management page
  When I enter "john" in the search field
  Then I should see only users with "john" in their name or email
```

### AC-5.5.2: View User Details

```gherkin
Scenario: View user details
  Given I am logged in as an Admin
  When I click on a user in the list
  Then I should see the user's detail page
  And I should see their profile information
  And I should see their assigned roles
  And I should see their registration date
  And I should see their last login date
```

### AC-5.5.3: Edit User

```gherkin
Scenario: Edit user information
  Given I am logged in as an Admin
  And I am viewing user details
  When I click "Edit" button
  And I change the user's name
  And I click "Save"
  Then the user information should be updated
  And I should see a success message

Scenario: Cannot edit own email
  Given I am logged in as an Admin
  When I try to edit my own account
  Then I should not be able to change my email
  And I should see a message "Email cannot be changed"
```

### AC-5.5.4: Deactivate User

```gherkin
Scenario: Deactivate a user
  Given I am logged in as an Admin
  And user "john@example.com" is active
  When I click "Deactivate" for that user
  And I confirm the action
  Then the user should be deactivated
  And the user should not be able to log in
  And I should see a success message

Scenario: Cannot deactivate self
  Given I am logged in as an Admin
  When I try to deactivate my own account
  Then I should see an error message "Cannot deactivate your own account"
  And my account should remain active
```

### AC-5.5.5: Reactivate User

```gherkin
Scenario: Reactivate a deactivated user
  Given I am logged in as an Admin
  And user "john@example.com" is deactivated
  When I click "Reactivate" for that user
  Then the user should be reactivated
  And the user should be able to log in again
  And I should see a success message
```

### AC-5.5.6: Delete User

```gherkin
Scenario: Delete a user
  Given I am logged in as an Admin
  When I click "Delete" for user "john@example.com"
  And I confirm by typing the user's email
  Then the user should be deleted
  And all user data should be removed
  And I should see a success message

Scenario: Cannot delete self
  Given I am logged in as an Admin
  When I try to delete my own account
  Then I should see an error message "Cannot delete your own account"
```

---

## Technical Notes

### Implementation
- **Page**: `src/app/dashboard/admin/users/page.tsx` - Users list
- **Page**: `src/app/dashboard/admin/users/[id]/page.tsx` - User details
- **API**: `src/app/api/users/route.ts` - User management endpoints
- **Component**: `src/components/UserManager.tsx` - User management UI

### Database
```sql
-- List users with pagination
SELECT u.*, GROUP_CONCAT(r.name) as roles
FROM User u
LEFT JOIN UserRole ur ON u.id = ur.userId
LEFT JOIN Role r ON ur.roleId = r.id
GROUP BY u.id
LIMIT 20 OFFSET ?;

-- Search users
SELECT * FROM User WHERE name LIKE ? OR email LIKE ?;

-- Deactivate user
UPDATE User SET isActive = false, updatedAt = now WHERE id = ?;

-- Delete user (cascade)
DELETE FROM User WHERE id = ?;
```

### API Endpoints
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/users` | List all users |
| GET | `/api/users/:id` | Get user details |
| PUT | `/api/users/:id` | Update user |
| DELETE | `/api/users/:id` | Delete user |
| POST | `/api/users/:id/deactivate` | Deactivate user |
| POST | `/api/users/:id/reactivate` | Reactivate user |

### Error Handling
| Error | HTTP Status | Message |
|-------|-------------|---------|
| User not found | 404 | "User not found" |
| Self action | 403 | "Cannot perform this action on your own account" |
| Last admin | 403 | "Cannot delete/deactivate the last admin" |

---

## RICE Score

| Factor | Value | Rationale |
|--------|-------|-----------|
| Reach | 30% | Only admins use this feature |
| Impact | 2 (High) | Important for user oversight |
| Confidence | 80% | Standard user management |
| Effort | 0.5 week | Basic CRUD operations |

**Score:** (30 × 2 × 0.8) / 0.5 = **96**
