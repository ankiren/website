---
title: "US-1.2: User Login with Google"
epic: User Authentication
status: In Progress
priority: Critical
github_issue: https://github.com/ankiren/website/issues/2
---

# US-1.2: User Login with Google

## Description

As a **registered user**,
I want to **login using my Google account**,
So that **I can access my flashcards and continue learning**.

---

## Acceptance Criteria

### Login Page
- [x] User can access login page at `/login`
- [x] User can navigate to registration page from login

### Google OAuth Login
- [x] "Continue with Google" button is visible on login page
- [x] Clicking the button redirects to Google OAuth consent screen
- [x] User can authorize Ankiren to access their Google profile
- [x] After authorization, user is redirected back to the app
- [x] Session is created after successful Google authentication
- [x] JWT session is created and stored in cookie
- [x] User is redirected to dashboard after successful login
- [x] Error message is shown if Google authentication fails

### Post-Login UI State
- [ ] "Sign In" button in hero section is hidden when user is logged in
- [ ] "Start Learning Free" button in hero section is hidden when user is logged in
- [ ] Navigation bar shows: Dashboard link, user email, and "Sign Out" button when logged in
- [ ] Navigation bar hides any duplicate "Sign In" links when logged in

### Account Linking
- [x] Existing users (same email) are linked to their Google account
- [x] User's name and profile picture are updated from Google (if available)

---

## Technical Notes

### Implementation
- **Auth Config**: `src/lib/auth.ts` - Google OAuth provider
- **Page**: `src/app/login/page.tsx` - Login page with Google button
- **Handler**: `src/app/api/auth/[...nextauth]/route.ts`
- **Home Page**: `src/app/page.tsx` - Conditional rendering based on session
- **Navbar**: `src/components/Navbar.tsx` - Show/hide buttons based on auth state

### Authentication Flow
```
User clicks "Continue with Google" on /login
    ↓
Redirect to Google OAuth consent screen
    ↓
User authorizes access
    ↓
Google redirects to /api/auth/callback/google
    ↓
NextAuth processes callback
    ↓
Query D1 for user by email or googleId
    ↓
Return user object
    ↓
Generate JWT session
    ↓
Set HTTP-only cookie
    ↓
Redirect to /dashboard
```

### Session Structure
```typescript
{
  user: {
    id: string,
    email: string,
    name: string | null,
    image: string | null
  },
  expires: string // ISO date
}
```

### Error Handling
| Error | Behavior |
|-------|----------|
| Google auth cancelled | Return to login page |
| Google auth error | Show error message |
| User not found | Redirect to registration |

---

## RICE Score

| Factor | Value | Rationale |
|--------|-------|-----------|
| Reach | 100% | All users need to login |
| Impact | 3 (Massive) | Required for access |
| Confidence | 100% | NextAuth.js has built-in Google support |
| Effort | 0.5 week | NextAuth handles complexity |

**Score:** (100 × 3 × 1.0) / 0.5 = **600**
