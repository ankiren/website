---
title: "US-1.1: User Registration"
epic: User Authentication
status: Done
priority: Critical
github_issue: https://github.com/ankiren/website/issues/1
---

# US-1.1: User Registration

## Description

As a **new user**,
I want to **create an account using my Google account**,
So that **I can save my flashcards and track my learning progress**.

---

## Acceptance Criteria

### AC-1.1.1: Registration Page Access

```gherkin
Scenario: Access registration page
  Given I am not logged in
  When I navigate to "/register"
  Then I should see the registration page
  And I should see a "Continue with Google" button
  And I should see a link to navigate to the login page
```

### AC-1.1.2: Successful Google Registration

```gherkin
Scenario: Successful registration with Google
  Given I am not logged in
  And I am on the registration page "/register"
  When I click the "Continue with Google" button
  Then I should be redirected to Google OAuth consent screen

Scenario: Complete Google authorization
  Given I am on the Google OAuth consent screen
  When I authorize Ankiren to access my Google profile
  Then a new account should be created with my Google email
  And my name should be imported from Google
  And my profile picture should be imported from Google
  And a JWT session should be created
  And I should be redirected to the dashboard "/dashboard"
```

### AC-1.1.3: Existing Account Handling

```gherkin
Scenario: Registration with existing Google account
  Given I am not logged in
  And a user with my Google email already exists
  When I click the "Continue with Google" button
  And I authorize Ankiren to access my Google profile
  Then I should be logged in to the existing account
  And I should be redirected to the dashboard "/dashboard"
```

### AC-1.1.4: Error Handling

```gherkin
Scenario: Google authentication cancelled
  Given I am on the registration page "/register"
  When I click the "Continue with Google" button
  And I cancel the Google OAuth consent
  Then I should be returned to the registration page
  And I should see an error message

Scenario: Google authentication fails
  Given I am on the registration page "/register"
  When I click the "Continue with Google" button
  And Google authentication fails
  Then I should see an error message "Authentication failed"
  And I should remain on the registration page
```

### AC-1.1.5: Navigation

```gherkin
Scenario: Navigate to login page
  Given I am on the registration page "/register"
  When I click the "Sign in" link
  Then I should be redirected to the login page "/login"
```

---

## Technical Notes

### Implementation
- **Page**: `src/app/register/page.tsx` - Registration page with Google button
- **Auth Config**: `src/lib/auth.ts` - Google OAuth provider and auto-registration

### Database
```sql
INSERT INTO User (id, email, name, image, googleId, createdAt, updatedAt)
VALUES (cuid(), googleEmail, googleName, googleImage, googleId, now, now)
```

### Google OAuth Flow
```
User clicks "Continue with Google" on /register
    ↓
Redirect to Google OAuth consent screen
    ↓
User authorizes access
    ↓
NextAuth signIn callback checks if user exists
    ├── User exists → Login (no new registration)
    └── New user → Create account with Google data
    ↓
Create JWT session
    ↓
Redirect to /dashboard
```

### Error Handling
| Error | Behavior |
|-------|----------|
| Google auth cancelled | Return to registration page |
| Google auth error | Show error message |
| Duplicate email (existing user) | Login instead of register |

---

## RICE Score

| Factor | Value | Rationale |
|--------|-------|-----------|
| Reach | 100% | All users need to register |
| Impact | 3 (Massive) | Foundation for all features |
| Confidence | 100% | NextAuth.js has built-in Google support |
| Effort | 0.5 week | Google OAuth + auto-registration |

**Score:** (100 × 3 × 1.0) / 0.5 = **600**
