---
title: "US-1.4: Login with Google"
epic: User Authentication
status: Done
priority: High
github_issue: https://github.com/ankiren/website/issues/16
---

# US-1.4: Login with Google

## Description

As a **user**,
I want to **login using my Google account**,
So that **I can quickly access the app without creating a new password**.

---

## Acceptance Criteria

- [x] "Continue with Google" button is visible on login page
- [x] "Continue with Google" button is visible on registration page
- [x] Clicking the button redirects to Google OAuth consent screen
- [x] User can authorize Ankiren to access their Google profile
- [x] After authorization, user is redirected back to the app
- [x] New users are automatically registered with their Google email
- [x] Existing users (same email) are linked to their Google account
- [x] User's name and profile picture are imported from Google (if available)
- [x] Session is created after successful Google authentication
- [x] User is redirected to dashboard after successful login
- [x] Error message is shown if Google authentication fails

---

## Technical Notes

### Implementation

- **Auth Config**: `src/lib/auth.ts` - Add Google provider
- **Page**: `src/app/login/page.tsx` - Add Google button
- **Page**: `src/app/register/page.tsx` - Add Google button

### NextAuth.js Google Provider Configuration

```typescript
// src/lib/auth.ts
import Google from "next-auth/providers/google"

export const authConfig = {
  providers: [
    Credentials({ ... }),
    Google({
      clientId: process.env.GOOGLE_CLIENT_ID,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET,
    }),
  ],
  callbacks: {
    async signIn({ user, account }) {
      if (account?.provider === "google") {
        // Check if user exists, create if not
        // Link Google account to existing user if email matches
      }
      return true
    },
  },
}
```

### Database Changes

Add optional fields to User table:
```sql
ALTER TABLE User ADD COLUMN googleId TEXT;
ALTER TABLE User ADD COLUMN image TEXT;
ALTER TABLE User ALTER COLUMN password DROP NOT NULL;
```

### Environment Variables

```bash
GOOGLE_CLIENT_ID="your-client-id.apps.googleusercontent.com"
GOOGLE_CLIENT_SECRET="your-client-secret"
```

### Google Cloud Console Setup

1. Create project in Google Cloud Console
2. Enable Google+ API
3. Configure OAuth consent screen
4. Create OAuth 2.0 credentials
5. Add authorized redirect URIs:
   - `http://localhost:3000/api/auth/callback/google` (development)
   - `https://uat.ankiren.com/api/auth/callback/google` (UAT)
   - `https://staging.ankiren.com/api/auth/callback/google` (staging)
   - `https://ankiren.com/api/auth/callback/google` (production)

### UI Component

```tsx
// Google Sign-In Button
<button
  onClick={() => signIn("google", { callbackUrl: "/dashboard" })}
  className="flex items-center justify-center gap-2 w-full border rounded-lg py-2"
>
  <GoogleIcon />
  Continue with Google
</button>
```

### User Flow

```
User clicks "Continue with Google"
    ↓
Redirect to Google OAuth consent screen
    ↓
User authorizes access
    ↓
Google redirects to /api/auth/callback/google
    ↓
NextAuth processes callback
    ↓
Check if user exists (by email or googleId)
    ├── New user → Create account with Google data
    └── Existing user → Link Google account (if not linked)
    ↓
Create JWT session
    ↓
Redirect to /dashboard
```

### Edge Cases

| Scenario | Behavior |
|----------|----------|
| New Google user | Create account, redirect to dashboard |
| Existing user (same email, no Google linked) | Link Google account, login |
| Existing user (already linked) | Login directly |
| Google auth cancelled | Return to login page with message |
| Google auth error | Show error message |

---

## Dependencies

- Google Cloud project with OAuth 2.0 configured
- Environment variables set in all environments
- Database migration for new fields

---

## RICE Score

| Factor | Value | Rationale |
|--------|-------|-----------|
| Reach | 80% | Most users prefer social login |
| Impact | 2 (High) | Reduces friction, improves conversion |
| Confidence | 100% | NextAuth.js has built-in Google support |
| Effort | 0.5 week | Provider config + UI + DB migration |

**Score:** (80 × 2 × 1.0) / 0.5 = **320**
